<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Sign in</title>
    <style>
        body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; background:#f6f7fb; margin:0; }
        .container { max-width: 420px; margin: 5vh auto; background:#fff; border-radius: 12px; box-shadow: 0 8px 24px rgba(0,0,0,0.08); overflow:hidden; }
        .tabs { display:flex; border-bottom:1px solid #eee; }
        .tab { flex:1; text-align:center; padding:14px; cursor:pointer; font-weight:600; color:#666; }
        .tab.active { color:#111; border-bottom:3px solid #4f46e5; }
        .content { padding: 20px 22px 26px; }
        .field { margin: 12px 0; }
        label { display:block; font-size: 13px; color:#444; margin-bottom:6px; }
        input[type=text], input[type=password] { width:90%; padding: 12px 12px; border:1px solid #dcdfe3; border-radius:8px; font-size:14px; }
        .actions { margin-top: 18px; display:flex; justify-content: flex-end; gap: 10px; }
        button { background:#4f46e5; color:#fff; border:0; padding:10px 14px; border-radius:8px; cursor:pointer; font-weight:600; }
        button.secondary { background:#eef0f6; color:#333; }
        .msg { padding: 10px 12px; border-radius:8px; font-size: 13px; margin-bottom: 12px; }
        .msg.error { background:#fee2e2; color:#991b1b; border:1px solid #fecaca; }
        .msg.success { background:#dcfce7; color:#14532d; border:1px solid #bbf7d0; }
        small.help { color:#6b7280; }
    </style>
    <script>
        function showTab(which) {
            const login = document.getElementById('loginTab');
            const register = document.getElementById('registerTab');
            const loginBtn = document.getElementById('tabLogin');
            const registerBtn = document.getElementById('tabRegister');
            if (which === 'register') {
                register.style.display = 'block';
                login.style.display = 'none';
                registerBtn.classList.add('active');
                loginBtn.classList.remove('active');
                document.getElementById('registerUsername').focus();
            } else {
                login.style.display = 'block';
                register.style.display = 'none';
                loginBtn.classList.add('active');
                registerBtn.classList.remove('active');
                document.getElementById('username').focus();
            }
        }
        window.addEventListener('DOMContentLoaded', function() {
            const url = new URL(window.location.href);
            // If coming from ?registered=, preselect login, if registerError present select register
            if (url.searchParams.get('registerError')) {
                showTab('register');
            } else {
                showTab('login');
            }
        });
    </script>
    <meta th:name="_csrf" th:content="${_csrf.token}" />
    <meta th:name="_csrf_header" th:content="${_csrf.headerName}" />
    <meta th:name="_csrf_parameter" th:content="${_csrf.parameterName}" />
    <meta name="robots" content="noindex" />
    <link rel="icon" href="data:," />
    <style> .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0} </style>
    <script>document.addEventListener('submit', e => { const btn=e.submitter; if(btn){btn.disabled=true; setTimeout(()=>btn.disabled=false, 1500);} });</script>
    <script>if(window.top!==window.self){document.documentElement.style.background='transparent'}</script>
</head>
<body>
<div class="container">
    <div class="tabs">
        <div id="tabLogin" class="tab active" onclick="showTab('login')">Login</div>
        <div id="tabRegister" class="tab" onclick="showTab('register')">Register</div>
    </div>
    <div class="content">
        <div th:if="${registered}" class="msg success">Registration successful. You can now log in.</div>
        <div th:if="${loginError}" class="msg error">Invalid username or password.</div>
        <div th:if="${registerError}" class="msg error" th:text="${registerError}"></div>

        <!-- Login form -->
        <div id="loginTab">
            <form th:action="@{/login}" method="post">
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                <div class="field">
                    <label for="username">Username</label>
                    <input id="username" name="username" type="text" autocomplete="username" required />
                </div>
                <div class="field">
                    <label for="password">Password</label>
                    <input id="password" name="password" type="password" autocomplete="current-password" required />
                </div>
                <div class="actions">
                    <button type="submit">Sign in</button>
                </div>
            </form>
        </div>

        <!-- Register form -->
        <div id="registerTab" style="display:none">
            <form th:action="@{/register}" method="post">
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                <div class="field">
                    <label for="registerUsername">Username</label>
                    <input id="registerUsername" name="username" type="text" required />
                </div>
                <div class="field">
                    <label for="registerPassword">Password</label>
                    <input id="registerPassword" name="password" type="password" required />
                </div>
                <div class="field">
                    <label for="confirmPassword">Confirm password</label>
                    <input id="confirmPassword" name="confirmPassword" type="password" required />
                </div>
                <div class="actions">
                    <button type="submit">Create account</button>
                </div>
            </form>
        </div>
    </div>
</div>
</body>
</html>
